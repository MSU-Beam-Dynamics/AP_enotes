
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Linear Transverse Motion &#8212; Accelerator Physics eNotes</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'transverse_BD/basic/Hamiltonian_Hills';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Twiss Parametrization" href="twiss_param.html" />
    <link rel="prev" title="Overview of Accelerator Magnets" href="../magnet/magnets.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Accelerator Physics eNotes - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Accelerator Physics eNotes - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Welcome to the Accelerator Physics eNotes
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Part I: Transverse Dynamics</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../magnet/magnets.html">Overview of Accelerator Magnets</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Linear Transverse Motion</a></li>
<li class="toctree-l1"><a class="reference internal" href="twiss_param.html">Twiss Parametrization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../perturbation/perturbed_motion.html">Perturbation of transverse motion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coupling/linear_transverse_coupling.html">Linear Coupling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dispersion/dispersion.html">Off Momentum Orbit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chrom/chromaticity.html">Chromatic Effect</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part II: Longitudinal Dynamics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../longitudinal_BD/longitudinal_dynamics.html">Longitudinal Dynamics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part III: Electron Storage Ring</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../ESR/SR/synchrotron_radiation.html">Synchrotron Radiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ESR/ESR_Dynamics/ESR_dynamics.html">Dynamics in Electron Storage Ring</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../appendix/symplecticity.html">Primer on symplecticity</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/MSU-Beam-Dynamics/AP_enotes/master?urlpath=tree/book/transverse_BD/basic/Hamiltonian_Hills.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/MSU-Beam-Dynamics/AP_enotes/blob/master/book/transverse_BD/basic/Hamiltonian_Hills.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/MSU-Beam-Dynamics/AP_enotes" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/MSU-Beam-Dynamics/AP_enotes/issues/new?title=Issue%20on%20page%20%2Ftransverse_BD/basic/Hamiltonian_Hills.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/transverse_BD/basic/Hamiltonian_Hills.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Linear Transverse Motion</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design-trajectory">Design Trajectory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-look-beam-motion-in-quadrupole-field">First look: Beam motion in Quadrupole field</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curvilinear-coordinate-system">Curvilinear Coordinate System</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hamiltonian-approach">Hamiltonian Approach</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lagrangian-to-hamiltonian">Lagrangian to Hamiltonian</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformation-to-frenet-serret-coordinate-system">Transformation to Frenet-Serret coordinate system</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-s-as-independent-variable">Use <span class="math notranslate nohighlight">\(s\)</span> as independent variable</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplifications-of-hamiltonian">Simplifications of Hamiltonian</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#further-assumptions">Further assumptions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#vector-potentials-for-linear-elements">Vector potentials for linear elements</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transfer-matrix-for-linear-elements">Transfer Matrix for Linear Elements</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drift-space">Drift space</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dipole-main">Dipole (main)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quadrupole-normal">Quadrupole (Normal)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chain-of-linear-elements">Chain of linear elements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-the-betatron-transfer-matrix">Properties of the betatron transfer matrix</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#symplectic-condition">Symplectic condition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#long-term-stability-condition">Long-term stability condition</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#revisit-the-weak-focusing">Revisit, the ‘weak focusing’</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="linear-transverse-motion">
<h1>Linear Transverse Motion<a class="headerlink" href="#linear-transverse-motion" title="Link to this heading">#</a></h1>
<p>In this chapter,we will discuss the particle motion in perpendicular to the  particle ideal trajectory in linear magnets.  Linear magnets refer to the dipole and quadrupole magnets that produce linear magnetic field.  The force of the particle is given by the Lorentz force:</p>
<div class="amsmath math notranslate nohighlight" id="equation-68e70709-cad0-4632-bd30-749196cc9ab3">
<span class="eqno">(39)<a class="headerlink" href="#equation-68e70709-cad0-4632-bd30-749196cc9ab3" title="Permalink to this equation">#</a></span>\[\begin{equation}
\mathbf{F}=q\mathbf{v}\times \mathbf{B}
\end{equation}\]</div>
<p>The force is always perpendicular to its velocity, therefore the particle can not be accelerated by the magnetic field.</p>
<section id="design-trajectory">
<h2>Design Trajectory<a class="headerlink" href="#design-trajectory" title="Link to this heading">#</a></h2>
<p>The geometry of the accelerator is determined by the dipole magnet.  Let us assume that the magnetic field is constant in certain region and along the vertical direction <span class="math notranslate nohighlight">\(\mathbf{B}=B\hat{y}\)</span>.  The particle travels through this region initially in <span class="math notranslate nohighlight">\(\hat{s}\)</span> direction in the <span class="math notranslate nohighlight">\(x\)</span>-<span class="math notranslate nohighlight">\(s\)</span> plane, as shown below.</p>
<figure class="align-right" id="id1">
<a class="reference internal image-reference" href="../../_images/reference_orbit.png"><img alt="../../_images/reference_orbit.png" src="../../_images/reference_orbit.png" style="width: 366.40000000000003px; height: 138.4px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 16 </span><span class="caption-text">Bending in a plane</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The equation of motion is</p>
<div class="amsmath math notranslate nohighlight" id="equation-74d3205d-5b2e-4b51-8201-0f9bb74605ad">
<span class="eqno">(40)<a class="headerlink" href="#equation-74d3205d-5b2e-4b51-8201-0f9bb74605ad" title="Permalink to this equation">#</a></span>\[\begin{equation}
\frac{d\mathbf{P}}{dt}=q\mathbf{v}\times\mathbf{B}
\end{equation}\]</div>
<p>The momentum change will be only in the <span class="math notranslate nohighlight">\(x\)</span>-<span class="math notranslate nohighlight">\(s\)</span> plane, the velocity is always perpendicular to the magnetic field and the energy of the beam does not change, therefore:</p>
<div class="amsmath math notranslate nohighlight" id="equation-a1c2c31c-96b3-4fa7-9f3d-fe82c1a38db5">
<span class="eqno">(41)<a class="headerlink" href="#equation-a1c2c31c-96b3-4fa7-9f3d-fe82c1a38db5" title="Permalink to this equation">#</a></span>\[\begin{equation}
m\gamma \frac{d\mathbf{v}}{dt}=qB\mathbf{v}\times\hat{y}
\end{equation}\]</div>
<p>Using the fact that the amplitude of the velocity will not change therefore:</p>
<div class="amsmath math notranslate nohighlight" id="equation-14f58827-8a2a-4bdd-9c06-f6514f71ddc1">
<span class="eqno">(42)<a class="headerlink" href="#equation-14f58827-8a2a-4bdd-9c06-f6514f71ddc1" title="Permalink to this equation">#</a></span>\[\begin{equation}
m\gamma \frac{v^2}{\rho}=qvB
\end{equation}\]</div>
<p>The bending radius is given by:</p>
<div class="amsmath math notranslate nohighlight" id="equation-7f389502-f337-43ed-9c65-25c800a098cd">
<span class="eqno">(43)<a class="headerlink" href="#equation-7f389502-f337-43ed-9c65-25c800a098cd" title="Permalink to this equation">#</a></span>\[\begin{equation}
\rho=\frac{\left|\mathbf{P}\right|}{qB}
\end{equation}\]</div>
<p>Here, we define the term ‘rigidity’ <span class="math notranslate nohighlight">\(B\rho=P/q\)</span>, to quantify ‘how hard to bend the beam’.  And naturally it is only function of the particle momentum amplitude.  It is a very important normalization factor of the transverse motion, as will shown later.  After normalization, most our calculation becomes particle energy independent.</p>
<p>The dipoles that defines the geometry of the accelerator are sometimes called main dipoles.  They define a ideal trajectory.  A charge particle with correct energy, once inject with correct position and angle, will exactly follow the ideal trajectory.</p>
</section>
<section id="first-look-beam-motion-in-quadrupole-field">
<h2>First look: Beam motion in Quadrupole field<a class="headerlink" href="#first-look-beam-motion-in-quadrupole-field" title="Link to this heading">#</a></h2>
<p>The quadrupole field, from the previous section, has</p>
<div class="amsmath math notranslate nohighlight" id="equation-969f1692-bf89-4c45-9f27-700bd266f1c8">
<span class="eqno">(44)<a class="headerlink" href="#equation-969f1692-bf89-4c45-9f27-700bd266f1c8" title="Permalink to this equation">#</a></span>\[\begin{align}
B_x&amp;=Gy\\
B_y&amp;=Gx
\end{align}\]</div>
<p>where the gradient is <span class="math notranslate nohighlight">\(G=B_0 b_1\)</span>.</p>
<p>Quadrupole is usually positioned so that the zero field axis is located on the ideal trajectory.  The ideal particle will not experience any field from the Quadrupole.</p>
<p>From the Lorentz force, we have</p>
<div class="math notranslate nohighlight">
\[\gamma m \frac{d\mathbf{v}}{dt} = q \mathbf{v}\times \mathbf{B}\]</div>
<p>Expand the vector production and get</p>
<div class="amsmath math notranslate nohighlight" id="equation-0133338f-d82a-4e58-ac83-f29f8c997404">
<span class="eqno">(45)<a class="headerlink" href="#equation-0133338f-d82a-4e58-ac83-f29f8c997404" title="Permalink to this equation">#</a></span>\[\begin{align}
\gamma m\frac{d^{2}x}{dt^{2}}&amp;=-qGxv_{z}\\
\gamma m\frac{d^{2}y}{dt^{2}}&amp;=qGyv_{z}
\end{align}\]</div>
<p>Here we need to make following approximation:</p>
<ul class="simple">
<li><p><strong>paraxial approximation</strong>, indicate that the particle will only deviate the design direction by small angles, i.e. if z is the forward direction, the two transverse velocity satisfy: <span class="math notranslate nohighlight">\(v_x,v_y \ll \left|\mathbf{v}\right|\)</span></p></li>
<li><p>In such approximation,</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-6605b411-edbb-4a89-a0c5-dd72a8ba56b6">
<span class="eqno">(46)<a class="headerlink" href="#equation-6605b411-edbb-4a89-a0c5-dd72a8ba56b6" title="Permalink to this equation">#</a></span>\[\begin{align}
v_z&amp;=\sqrt{v^2-v_x^2-v_y^2}\nonumber\\
&amp;=v\left(1-\frac{v_x^2+v_y^2}{2v^2}\right)\sim v
\end{align}\]</div>
<ul class="simple">
<li><p>Using such approximation, we have</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{d}{dt}=v_s\frac{d}{ds}\sim v\frac{d}{ds}\;\frac{d^2}{dt^2}\sim v^2\frac{d^2}{ds^2}\]</div>
<p>Then the equation of motion in quadrupole is simplified as</p>
<div class="amsmath math notranslate nohighlight" id="equation-c590b925-e9cc-48e7-931c-e25d3dd87ebd">
<span class="eqno">(47)<a class="headerlink" href="#equation-c590b925-e9cc-48e7-931c-e25d3dd87ebd" title="Permalink to this equation">#</a></span>\[\begin{align}
\gamma m v\frac{d^{2}x}{ds^{2}}&amp;=-qGx\\
\gamma m v\frac{d^{2}y}{ds^{2}}&amp;=qGy
\end{align}\]</div>
<p>Using the definition of the rigidity <span class="math notranslate nohighlight">\(B\rho\)</span>, the EOM can be rewritten as :</p>
<div class="amsmath math notranslate nohighlight" id="equation-94c17aa6-83b3-467c-aada-44cf067d4c2e">
<span class="eqno">(48)<a class="headerlink" href="#equation-94c17aa6-83b3-467c-aada-44cf067d4c2e" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{d^{2}x}{ds^{2}}&amp;=-\frac{G}{B\rho}x\\
\frac{d^{2}y}{ds^{2}}&amp;=\frac{G}{B\rho}y
\end{align}\]</div>
<p>Then, we define the normalized quadrupole strength <span class="math notranslate nohighlight">\(k=G/(B\rho)\)</span>, the EOM is simply:</p>
<div class="amsmath math notranslate nohighlight" id="equation-1a347f48-32ff-4187-82ec-d51c126be168">
<span class="eqno">(49)<a class="headerlink" href="#equation-1a347f48-32ff-4187-82ec-d51c126be168" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{d^{2}x}{ds^{2}}+kx&amp;=0\\
\frac{d^{2}y}{ds^{2}}-ky&amp;=0
\end{align}\]</div>
<p>Depend on the sign of <span class="math notranslate nohighlight">\(k\)</span>, it is easy to solve the differential equation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-7824148b-ad4c-4733-89ec-9fd291e22957">
<span class="eqno">(50)<a class="headerlink" href="#equation-7824148b-ad4c-4733-89ec-9fd291e22957" title="Permalink to this equation">#</a></span>\[\begin{equation}
x\left(s\right)=
\begin{cases}
a \cos \left(\sqrt{k}s\right)+b \sin \left(\sqrt{k}s\right)&amp;k&gt;0\\
a s + b &amp;k=0\\
a \cosh \left(\sqrt{-k}s\right)+b\sinh \left(\sqrt{-k}s\right)&amp;k&lt;0
\end{cases}
\end{equation}\]</div>
<p>The three cases corresponds to a focusing quadrupole, drift space and a defocusing quadrupole respectively. The parameter <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span> are determined by the initial particle position <span class="math notranslate nohighlight">\(x\)</span> and its derivative <span class="math notranslate nohighlight">\(x'\)</span>. We also learn that the quadrupole will always focus the particles in one transverse direction and defocus in the other.</p>
<p>In general, the focusing strength can be also function of the longitudinal direction and the EOM of transverse motion (using horizontal direction <span class="math notranslate nohighlight">\(\hat{x}\)</span> as an example) gives:</p>
<div class="amsmath math notranslate nohighlight" id="equation-063c47c4-eec1-4f99-b932-882ffb3356af">
<span class="eqno">(51)<a class="headerlink" href="#equation-063c47c4-eec1-4f99-b932-882ffb3356af" title="Permalink to this equation">#</a></span>\[\begin{equation}
\frac{d^{2}x}{ds^{2}}+k\left(s\right)x=0
\end{equation}\]</div>
<p>This ODE is named Hill’s equation.  It can be rewritten as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-7b1fc010-b8af-46d8-b294-83a0fff38ba3">
<span class="eqno">(52)<a class="headerlink" href="#equation-7b1fc010-b8af-46d8-b294-83a0fff38ba3" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{dx}{ds}&amp;=x'\\
\frac{dx'}{ds}&amp;=-k(s)x
\end{align}\]</div>
<p>They are just the form of Hamiltonian equations of the Hamiltonian:</p>
<div class="amsmath math notranslate nohighlight" id="equation-f51a824e-0aba-4641-98a3-bfb571b1fce0">
<span class="eqno">(53)<a class="headerlink" href="#equation-f51a824e-0aba-4641-98a3-bfb571b1fce0" title="Permalink to this equation">#</a></span>\[\begin{align}
H=\frac{1}{2}x'^2+\frac{1}{2}k(s)x^2
\end{align}\]</div>
<p>Latter we will use alternative method to rederive this equation and try to solve it in general.</p>
</section>
<section id="curvilinear-coordinate-system">
<h2>Curvilinear Coordinate System<a class="headerlink" href="#curvilinear-coordinate-system" title="Link to this heading">#</a></h2>
<p>The ideal trajectory is usually used as reference for the dynamics of the charged particles. This trajectory can be determined from a vector <span class="math notranslate nohighlight">\(\mathbf{r_0}\left(t\right)\)</span>. The length along the curve is given by</p>
<div class="amsmath math notranslate nohighlight" id="equation-8981d818-c87c-4141-ae5f-ba6161c47b23">
<span class="eqno">(54)<a class="headerlink" href="#equation-8981d818-c87c-4141-ae5f-ba6161c47b23" title="Permalink to this equation">#</a></span>\[\begin{align}
s(t)=\int_0^t \left|\mathbf{r'_0}\left(t^\prime\right)\right| dt^\prime
\end{align}\]</div>
<p>Therefore our study is usually performed in the curvilinear coordinate system, named Frenet-Serret coordinate system, as illustrated in the figure:</p>
<figure class="align-right" id="id2">
<a class="reference internal image-reference" href="../../_images/curvilinear_frame.png"><img alt="../../_images/curvilinear_frame.png" src="../../_images/curvilinear_frame.png" style="width: 321.20000000000005px; height: 239.60000000000002px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">Frenet Serret coordinate</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In this representation, the independent variable is the location on the reference orbit <span class="math notranslate nohighlight">\(s\)</span>.  The reference point on the reference orbit is defined by the vector <span class="math notranslate nohighlight">\(\mathbf{r_0}\left(s\right)\)</span>.  The unit vector of the tangent direction is given by:</p>
<div class="amsmath math notranslate nohighlight" id="equation-cb2c2db5-4f71-4593-9f41-06844845ab64">
<span class="eqno">(55)<a class="headerlink" href="#equation-cb2c2db5-4f71-4593-9f41-06844845ab64" title="Permalink to this equation">#</a></span>\[\begin{equation}
\hat{s}\left(s\right)=\frac{d\mathbf{r_0}\left(s\right)}{ds}
\end{equation}\]</div>
<p>The unit vector of the tangent plane and the normal plane is:</p>
<div class="amsmath math notranslate nohighlight" id="equation-03a96ee7-4e72-44b1-872d-35d04c814118">
<span class="eqno">(56)<a class="headerlink" href="#equation-03a96ee7-4e72-44b1-872d-35d04c814118" title="Permalink to this equation">#</a></span>\[\begin{equation}\hat{x}\left(s\right)=-\rho\left(s\right)\frac{d\hat{s}\left(s\right)}{ds}
\end{equation}\]</div>
<p>Here <span class="math notranslate nohighlight">\(\rho\)</span> denotes the local radius, which is the recipocal of the curvature <span class="math notranslate nohighlight">\(\kappa\)</span>. At last, the binormal vector is simply defined by:</p>
<div class="amsmath math notranslate nohighlight" id="equation-f587e34d-f1c5-4602-a93f-ebb43525abe3">
<span class="eqno">(57)<a class="headerlink" href="#equation-f587e34d-f1c5-4602-a93f-ebb43525abe3" title="Permalink to this equation">#</a></span>\[\begin{equation}
\hat{y}\left(s\right)=\hat{s}\left(s\right)\times\hat{x}\left(s\right)
\end{equation}\]</div>
<p>We defining The derivative of the unit vectors are:</p>
<div class="amsmath math notranslate nohighlight" id="equation-af0f7100-03b5-4256-8965-0f0611c31ad3">
<span class="eqno">(58)<a class="headerlink" href="#equation-af0f7100-03b5-4256-8965-0f0611c31ad3" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{d\hat{s}\left(s\right)}{ds} &amp;= -\kappa\left(s\right) \hat{x}\left(s\right)\\
\frac{d\hat{x}\left(s\right)}{ds} &amp;= \kappa\left(s\right) \hat{s}\left(s\right)+\tau\left(s\right)\hat{y}\left(s\right)\\
\frac{d\hat{y}\left(s\right)}{ds} &amp;= -\tau\left(s\right)\hat{x}\left(s\right)
\end{align}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\tau\)</span> is the local torsion of the curve.
In matrix form, the relation can be expressed as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-7b51bfa1-ec3a-4dd9-b1af-984010aa042d">
<span class="eqno">(59)<a class="headerlink" href="#equation-7b51bfa1-ec3a-4dd9-b1af-984010aa042d" title="Permalink to this equation">#</a></span>\[\begin{equation}
\frac{{d}}{ds}\left(\begin{array}{c}
\hat{{s}}\\
\hat{{x}}\\
\hat{y}
\end{array}\right)=\left(\begin{array}{ccc}
0 &amp; -\kappa &amp; 0\\
\kappa &amp; 0 &amp; \tau\\
0 &amp; -\tau &amp; 0
\end{array}\right)\left(\begin{array}{c}
\hat{{s}}\\
\hat{{x}}\\
\hat{y}
\end{array}\right)
\end{equation}\]</div>
<p>In most cases, we focus our discussion on the motion in plane geometry, therefore the torsion is zero.</p>
<p>Then, the coordinate of particle can be expressed as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b67a36cc-c16c-4c4e-9b7b-19d4b295c483">
<span class="eqno">(60)<a class="headerlink" href="#equation-b67a36cc-c16c-4c4e-9b7b-19d4b295c483" title="Permalink to this equation">#</a></span>\[\begin{equation}
\mathbf{r}=\mathbf{r_0}\left(s\right)+x\hat{x}\left(s\right)+y\hat{y}\left(s\right)
\end{equation}\]</div>
<p>Compared with the Cartesian coordinate system, <span class="math notranslate nohighlight">\(\mathbf{r}=x \hat{x}+y \hat{y}+z \hat{z} \)</span>, the differentials give: <span class="math notranslate nohighlight">\(\partial \mathbf{r}/\partial x = \hat{x}\)</span>, <span class="math notranslate nohighlight">\(\partial \mathbf{r}/\partial y = \hat{y}\)</span>, <span class="math notranslate nohighlight">\(\partial \mathbf{r}/\partial z = \hat{z}\)</span>; the differentials of the Frenet-Serret Coordinate yields:</p>
<div class="amsmath math notranslate nohighlight" id="equation-181ee3e8-f01b-4175-97c7-48c0aa2d8761">
<span class="eqno">(61)<a class="headerlink" href="#equation-181ee3e8-f01b-4175-97c7-48c0aa2d8761" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{\partial \mathbf{r}}{\partial s} &amp;= \hat{s}\left(1+ \kappa x\right) \\
\frac{\partial \mathbf{r}}{\partial x} &amp;= \hat{x} \\
\frac{\partial \mathbf{r}}{\partial y} &amp;= \hat{y}
\end{align}\]</div>
<p>The Lame coefficient of the Frenet-Serret coordinate system is <span class="math notranslate nohighlight">\(h_s=1+\kappa x\)</span> and <span class="math notranslate nohighlight">\(h_x=h_y=1\)</span>.</p>
<p>In this coordinate system, the vector operation has different form, for example:</p>
<div class="amsmath math notranslate nohighlight" id="equation-89853f30-57fa-40c2-866e-09e60d9dc587">
<span class="eqno">(62)<a class="headerlink" href="#equation-89853f30-57fa-40c2-866e-09e60d9dc587" title="Permalink to this equation">#</a></span>\[\begin{equation}
\nabla \phi = \frac{1}{1+\kappa x}\frac{\partial \phi}{\partial s}\hat{s}+\frac{\partial \phi}{\partial x}\hat{x}+\frac{\partial \phi}{\partial y}\hat{y}
\end{equation}\]</div>
<p>And the curl of the vector gives:</p>
<div class="amsmath math notranslate nohighlight" id="equation-e07cc84d-f83d-46d1-8e43-dbf875aaced6">
<span class="eqno">(63)<a class="headerlink" href="#equation-e07cc84d-f83d-46d1-8e43-dbf875aaced6" title="Permalink to this equation">#</a></span>\[\begin{equation}
\nabla\times A=\frac{1}{1+\kappa x}\left|\begin{array}{ccc}
\left(1+\kappa x\right)\hat{{s}} &amp; \hat{{x}} &amp; \hat{y}\\
\frac{\partial}{\partial s} &amp; \frac{\partial}{\partial x} &amp; \frac{\partial}{\partial y}\\
\left(1+\kappa x\right)A_{s} &amp; A_{x} &amp; A_{y}
\end{array}\right|
\end{equation}\]</div>
</section>
<section id="hamiltonian-approach">
<h2>Hamiltonian Approach<a class="headerlink" href="#hamiltonian-approach" title="Link to this heading">#</a></h2>
<section id="lagrangian-to-hamiltonian">
<h3>Lagrangian to Hamiltonian<a class="headerlink" href="#lagrangian-to-hamiltonian" title="Link to this heading">#</a></h3>
<p>We consider the approach from Lagrangian of a relativistic charged particle in a E-M field.</p>
<div class="amsmath math notranslate nohighlight" id="equation-6818522c-3808-45be-b19a-9298e8af1291">
<span class="eqno">(64)<a class="headerlink" href="#equation-6818522c-3808-45be-b19a-9298e8af1291" title="Permalink to this equation">#</a></span>\[\begin{equation}
L\left(\mathbf{x}, \mathbf{v}, t\right)=
-mc^2\sqrt{1-\frac{v^2}{c^2}}
+e\mathbf{v}\cdot \mathbf{A}\left(\mathbf{x},t\right)
-e\phi \left(\mathbf{x},t\right)
\end{equation}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> is the position and the velocity is <span class="math notranslate nohighlight">\(\mathbf{v}=\dot{\mathbf{x}} =d\mathbf{x}/dt\)</span>. The vector potential <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> and scalar potential <span class="math notranslate nohighlight">\(\phi\)</span> is the function of the position and time.  The fields is calculated as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-d922d2f3-6aa7-4284-ad3f-168dfa7ee3d7">
<span class="eqno">(65)<a class="headerlink" href="#equation-d922d2f3-6aa7-4284-ad3f-168dfa7ee3d7" title="Permalink to this equation">#</a></span>\[\begin{align}
\mathbf{E}&amp;=-\nabla\phi-\frac{\partial\mathbf{A}}{\partial t}\\
\mathbf{B}&amp;=\nabla\times\mathbf{A}
\end{align}\]</div>
<p>The equation of motion can be derived from the equation</p>
<div class="amsmath math notranslate nohighlight" id="equation-8c4c3a0a-a843-4745-80a2-e6a6264ded5d">
<span class="eqno">(66)<a class="headerlink" href="#equation-8c4c3a0a-a843-4745-80a2-e6a6264ded5d" title="Permalink to this equation">#</a></span>\[\begin{equation}
\frac{\partial L}{x_i}=\frac{d}{dt}\frac{\partial L}{\dot{x}_i}
\end{equation}\]</div>
<p>Using the Lagrangian above will get the EOM with Lorentz force.</p>
<p>We are interested in the generalized momentum <span class="math notranslate nohighlight">\(P_i\)</span> of the <span class="math notranslate nohighlight">\(i^{th}\)</span> coordinate <span class="math notranslate nohighlight">\(x_i\)</span> which is given by:</p>
<div class="amsmath math notranslate nohighlight" id="equation-01a7f0fe-a5f8-4f74-99cc-574bf3ec7696">
<span class="eqno">(67)<a class="headerlink" href="#equation-01a7f0fe-a5f8-4f74-99cc-574bf3ec7696" title="Permalink to this equation">#</a></span>\[\begin{align}
P_i&amp;=\frac{\partial L}{\partial \dot{x}_i} \nonumber\\
   &amp;=\frac{m\dot{x}_i}{\sqrt{1-\frac{v^2}{c^2}}}+eA_i \nonumber\\
   &amp;=p_i+eA_i
\end{align}\]</div>
<p>Here <span class="math notranslate nohighlight">\(p_i\)</span> is the momentum of the particle.  The above components can be combined to get a vector form, <span class="math notranslate nohighlight">\(\mathbf{P}=\mathbf{p}+e\mathbf{A}\)</span>, between the generalized (or conjugate) momentum <span class="math notranslate nohighlight">\(\mathbf{P}\)</span>, the momentum <span class="math notranslate nohighlight">\(\mathbf{p}\)</span> and the vector potential <span class="math notranslate nohighlight">\(\mathbf{A}\)</span>.</p>
<p>Then the Hamiltonian is calculated as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-baff8a19-6c4c-418e-8712-b77e2771e6bb">
<span class="eqno">(68)<a class="headerlink" href="#equation-baff8a19-6c4c-418e-8712-b77e2771e6bb" title="Permalink to this equation">#</a></span>\[\begin{align}
H&amp;=\mathbf{v}\cdot\mathbf{P}-L \nonumber\\
&amp;=\mathbf{v}\cdot\mathbf{p}+e\mathbf{v}\cdot\mathbf{A}+mc^2\sqrt{1-\frac{v^2}{c^2}}
    -e\mathbf{v}\cdot \mathbf{A}\left(\mathbf{x},t\right)
    +e\phi \left(\mathbf{x},t\right) \nonumber\\
&amp;=\gamma m v^2 +mc^2\sqrt{1-\frac{v^2}{c^2}}+e\phi \left(\mathbf{x},t\right) \nonumber\\
&amp;=(\gamma\beta^2+1/\gamma)mc^2+e\phi \left(\mathbf{x},t\right) \nonumber\\
&amp;=\gamma mc^2 +e\phi \left(\mathbf{x},t\right)
\end{align}\]</div>
<p>With no surprise, the Hamiltonian reflects the total energy of the particle and the potential energy in the E-M field. For further analysis, we express the Hamiltonian as function of the conjugate variable pair:</p>
<div class="amsmath math notranslate nohighlight" id="equation-bc4d6326-95c9-4d00-bf15-fc18c62974ad">
<span class="eqno">(69)<a class="headerlink" href="#equation-bc4d6326-95c9-4d00-bf15-fc18c62974ad" title="Permalink to this equation">#</a></span>\[\begin{align}
H(\mathbf{x},\mathbf{p})&amp;=H\left(x_1,\cdots,x_n, P_1,\cdots,P_n, t\right)\\
&amp;=\sqrt{\left(m c^2\right)^2
+\left(\mathbf{P}-e\mathbf{A}\left(\mathbf{x},t\right)\right)^2c^2}
+e\phi\left(\mathbf{x},t\right)
\end{align}\]</div>
<p>Later we will use a series of canonical transformations to change the coordinates and independent variable.  A generating function is handy to create the canonical transformations from old coordinate <span class="math notranslate nohighlight">\((q,p)\)</span> to a new set (Q,P). There are four types of generating functions:</p>
<figure class="align-left" id="id3">
<a class="reference internal image-reference" href="../../_images/generating_function.png"><img alt="../../_images/generating_function.png" src="../../_images/generating_function.png" style="width: 156.0px; height: 132.9px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text">Cheat sheet of<br />
canonical Transformation</span><a class="headerlink" href="#id3" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="amsmath math notranslate nohighlight" id="equation-4e0bf7ae-542f-4812-ab34-b8bec9bb092a">
<span class="eqno">(70)<a class="headerlink" href="#equation-4e0bf7ae-542f-4812-ab34-b8bec9bb092a" title="Permalink to this equation">#</a></span>\[\begin{align}
F_1=F_1(\mathbf{q},\mathbf{Q},t) \quad &amp;  \mathbf{p}=\frac{\partial F_1}{\partial \mathbf{q}}; \mathbf{P}=-\frac{\partial F_1}{\partial \mathbf{Q}}\\
F_2=F_2(\mathbf{q},\mathbf{P},t) \quad &amp; \mathbf{p}=\frac{\partial F_2}{\partial \mathbf{q}}; \mathbf{Q}=\frac{\partial F_2}{\partial \mathbf{P}}\\
F_3=F_3(\mathbf{p},\mathbf{Q},t) \quad &amp; \mathbf{q}=-\frac{\partial F_3}{\partial \mathbf{p}}; \mathbf{P}=-\frac{\partial F_3}{\partial \mathbf{Q}}\\
F_4=F_4(\mathbf{p},\mathbf{P},t) \quad &amp; \mathbf{q}=-\frac{\partial F_4}{\partial \mathbf{P}}; \mathbf{Q}=\frac{\partial F_4}{\partial \mathbf{P}}
\end{align}\]</div>
<p>The right figure shows a way to remember the relative relations of the generating functions.  The new Hamiltonian <span class="math notranslate nohighlight">\(K(Q,P,t)\)</span> is calculated by:</p>
<div class="amsmath math notranslate nohighlight" id="equation-a35dd513-8224-496f-b16c-4dea258744da">
<span class="eqno">(71)<a class="headerlink" href="#equation-a35dd513-8224-496f-b16c-4dea258744da" title="Permalink to this equation">#</a></span>\[\begin{align}
K(\mathbf{Q},\mathbf{P},t)=H\left(\mathbf{q}(\mathbf{Q},\mathbf{P}),\mathbf{p}(\mathbf{Q},\mathbf{P})\right)+\frac{\partial F}{\partial t}
\end{align}\]</div>
</section>
<section id="transformation-to-frenet-serret-coordinate-system">
<h3>Transformation to Frenet-Serret coordinate system<a class="headerlink" href="#transformation-to-frenet-serret-coordinate-system" title="Link to this heading">#</a></h3>
<p>The first necessary transformation that we need to make is to change the coordinate system to the Frenet-Serret coordinate system, i.e. from Cartesian coordinate <span class="math notranslate nohighlight">\(\mathbf{r}=x\hat{x}+y\hat{y}+z\hat{z}\)</span> to <span class="math notranslate nohighlight">\(\mathbf{r}=\mathbf{r}_0(s)+x\hat{x}(s)+y\hat{y}(s)\)</span>.<br />
We use the generating function of the <span class="math notranslate nohighlight">\(3^{rd}\)</span> type to perform this transformation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-e6d21e86-070b-4ce3-96c5-8096c6147db9">
<span class="eqno">(72)<a class="headerlink" href="#equation-e6d21e86-070b-4ce3-96c5-8096c6147db9" title="Permalink to this equation">#</a></span>\[\begin{equation}
F_3=-\mathbf{P}\cdot\left(\mathbf{r}_0(s)+x\hat{x}(s)+y\hat{y}(s)\right)
\end{equation}\]</div>
<p>The new conjugate momentum, <span class="math notranslate nohighlight">\(\boldsymbol{\Pi}\)</span> can be calculated as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-c3d0ee15-fca9-47ed-a8b3-ea512be81d64">
<span class="eqno">(73)<a class="headerlink" href="#equation-c3d0ee15-fca9-47ed-a8b3-ea512be81d64" title="Permalink to this equation">#</a></span>\[\begin{align}
\Pi_x&amp;=-\frac{\partial F_3}{\partial x}=\mathbf{P}\cdot\hat{x}\\
\Pi_y&amp;=-\frac{\partial F_3}{\partial y}=\mathbf{P}\cdot\hat{y}\\
\Pi_s&amp;=-\frac{\partial F_3}{\partial s}=\mathbf{P}\cdot\hat{s}\left(1+\frac{x}{\rho}\right)\\
\end{align}\]</div>
<p>Therefore, in the Frenet-Serret coordinate system:</p>
<div class="amsmath math notranslate nohighlight" id="equation-47f1d78d-aab6-4f0b-9155-fcdd9db93347">
<span class="eqno">(74)<a class="headerlink" href="#equation-47f1d78d-aab6-4f0b-9155-fcdd9db93347" title="Permalink to this equation">#</a></span>\[\begin{equation}
H=c\sqrt{
\left(m c\right)^2
+\left(\Pi_x-eA_x\right)^2+\left(\Pi_y-eA_y\right)^2
+\left(\frac{\Pi_s}{1+x/\rho}-eA_s\right)^2
} +e\phi
\end{equation}\]</div>
<p>The vector potential now also take its components from the Frenet-Serret coordinate system as <span class="math notranslate nohighlight">\(A_x=\mathbf{A}\cdot\hat{x}\)</span>, <span class="math notranslate nohighlight">\(A_y=\mathbf{A}\cdot\hat{y}\)</span> and <span class="math notranslate nohighlight">\(A_s=\mathbf{A}\cdot\hat{s}\)</span>.  Sometimes, the longitudinal component of the vector potential also can be define as <span class="math notranslate nohighlight">\(A_s=\mathbf{A}\cdot \frac{\partial \mathbf{r}}{\partial s}= (1+x/\rho) \mathbf{A}\cdot\hat{s}\)</span>, which will <strong>NOT</strong> be used in the latter contents.</p>
</section>
<section id="use-s-as-independent-variable">
<h3>Use <span class="math notranslate nohighlight">\(s\)</span> as independent variable<a class="headerlink" href="#use-s-as-independent-variable" title="Link to this heading">#</a></h3>
<p>Next, we need charge the independent coordinate from time to ‘<span class="math notranslate nohighlight">\(s\)</span>’, the position on the reference orbit. The Hamiltonian above is function of <span class="math notranslate nohighlight">\((x,\Pi_x, y, \Pi_y, s, \Pi_s,t)\)</span> and the Hamiltonian equation are:</p>
<div class="amsmath math notranslate nohighlight" id="equation-859b71b1-8930-4a61-88d8-8ad3c49b0b71">
<span class="eqno">(75)<a class="headerlink" href="#equation-859b71b1-8930-4a61-88d8-8ad3c49b0b71" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{\partial H}{\partial x}&amp;=-\dot{\Pi}_x &amp; \frac{\partial H}{\partial \Pi_x}&amp;=\dot{x} \\
\frac{\partial H}{\partial y}&amp;=-\dot{\Pi}_y &amp; \frac{\partial H}{\partial \Pi_y}&amp;=\dot{y} \\
\frac{\partial H}{\partial s}&amp;=-\dot{\Pi}_s &amp; \frac{\partial H}{\partial \Pi_s}&amp;=\dot{s}
\end{align}\]</div>
<p>To change the independent coordinate to <span class="math notranslate nohighlight">\(s\)</span>, we first look at the derivative:</p>
<div class="amsmath math notranslate nohighlight" id="equation-6007e530-6d39-4615-b88c-26afe77dea88">
<span class="eqno">(76)<a class="headerlink" href="#equation-6007e530-6d39-4615-b88c-26afe77dea88" title="Permalink to this equation">#</a></span>\[\begin{equation}
x^\prime\equiv\frac{dx}{ds}=\frac{dx}{dt}\left(\frac{ds}{dt}\right)^{-1}
=\frac{\partial H}{\partial \Pi_x}\left(\frac{\partial H}{\partial \Pi_s}\right)^{-1}
\end{equation}\]</div>
<p>Using the differential chain rule of the implicit equation <span class="math notranslate nohighlight">\(H(x,\Pi_x, y, \Pi_y, s, \Pi_s,t)-f(t)=0\)</span>, we have:</p>
<div class="amsmath math notranslate nohighlight" id="equation-9d28be2c-283c-4634-9956-3235cbeff43c">
<span class="eqno">(77)<a class="headerlink" href="#equation-9d28be2c-283c-4634-9956-3235cbeff43c" title="Permalink to this equation">#</a></span>\[\begin{equation}
x^\prime\equiv\frac{dx}{ds}=-\frac{\partial \Pi_s}{\partial \Pi_x}
\end{equation}\]</div>
<p>Use the similar trick, we will find that</p>
<div class="amsmath math notranslate nohighlight" id="equation-4bfaf86f-5f70-4374-812d-7b980f18e3bc">
<span class="eqno">(78)<a class="headerlink" href="#equation-4bfaf86f-5f70-4374-812d-7b980f18e3bc" title="Permalink to this equation">#</a></span>\[\begin{align}
{\Pi_x}^\prime&amp;\equiv\frac{d\Pi_x}{ds}=\frac{\partial \Pi_s}{\partial x}\\
y^\prime&amp;\equiv\frac{dy}{ds}=-\frac{\partial \Pi_s}{\partial \Pi_y}\\
{\Pi_y}^\prime&amp;\equiv\frac{d\Pi_y}{ds}=\frac{\partial \Pi_s}{\partial y}\\
\end{align}\]</div>
<p>We also find the other two relationship easily:</p>
<div class="amsmath math notranslate nohighlight" id="equation-ed88fac8-454d-4bfb-9f49-5ab1dfa8bb44">
<span class="eqno">(79)<a class="headerlink" href="#equation-ed88fac8-454d-4bfb-9f49-5ab1dfa8bb44" title="Permalink to this equation">#</a></span>\[\begin{equation}
t^\prime\equiv\frac{dt}{ds}=\left(\frac{\partial H}{\partial \Pi_s}\right)^{-1}=\frac{\partial \Pi_s}{\partial H}
\end{equation}\]</div>
<div class="amsmath math notranslate nohighlight" id="equation-f884cd84-1e9b-476a-ae09-f03f98850b5e">
<span class="eqno">(80)<a class="headerlink" href="#equation-f884cd84-1e9b-476a-ae09-f03f98850b5e" title="Permalink to this equation">#</a></span>\[\begin{equation}
H^\prime\equiv\frac{dH}{ds}=-\frac{\partial \Pi_s}{\partial t}
\end{equation}\]</div>
<p>Therefore we can choose the new Hamiltonian <span class="math notranslate nohighlight">\(K=-\Pi_s(x,\Pi_x, y, \Pi_y, H, t,s)\)</span>, which will satisfy the Hamiltonian relation.  However, it is awkward to set <span class="math notranslate nohighlight">\(H\)</span> as the ‘coordinate’ and <span class="math notranslate nohighlight">\(t\)</span> as ‘general momentum’.  To fix this, we can set the conjugate pair as <span class="math notranslate nohighlight">\((t,-H)\)</span>.  Therefore the new Hamiltonian reads:</p>
<div class="amsmath math notranslate nohighlight" id="equation-40e16da7-099c-4a11-8769-f42a7d6bab17">
<span class="eqno">(81)<a class="headerlink" href="#equation-40e16da7-099c-4a11-8769-f42a7d6bab17" title="Permalink to this equation">#</a></span>\[\begin{align}
K\left(x,\Pi_x, y, \Pi_y, t, -H,s\right) = -\Pi_s \nonumber\\
=-\left(1+\frac{x}{\rho}\right)\sqrt{\left(\frac{H-e\phi}{c}\right)^2-(mc)^2-\left(\Pi_x-eA_x\right)^2-\left(\Pi_y-eA_y\right)^2}\nonumber\\-eA_s\left(1+\frac{x}{\rho}\right)
\end{align}\]</div>
</section>
<section id="simplifications-of-hamiltonian">
<h3>Simplifications of Hamiltonian<a class="headerlink" href="#simplifications-of-hamiltonian" title="Link to this heading">#</a></h3>
<p>Since the new Hamiltonian has a very complicated form, we will use the following simplifications.</p>
<ul class="simple">
<li><p>First, we have seen that for 2-D magnetic field, only the longitudinal vector potential is needed. We can set the both transverse potential to be zero: <span class="math notranslate nohighlight">\(A_x=A_y=0\)</span>. Then, the generalized momentum reduce to the particle’s momentum <span class="math notranslate nohighlight">\(\Pi_{x/y}=p_{x/y}\)</span>.</p></li>
<li><p>Second, let us assume the potential <span class="math notranslate nohighlight">\(\phi\)</span> is not time dependent, then we can make canonical transformation <span class="math notranslate nohighlight">\((t, -H)\)</span> to <span class="math notranslate nohighlight">\((t, -h)\)</span> with <span class="math notranslate nohighlight">\(h=H-e\phi\)</span>.  <span class="math notranslate nohighlight">\(h\)</span> is just the total energy of the particle and the first two terms give the momentum of the particle  <span class="math notranslate nohighlight">\(p^2=\left(h/c\right)^2-(mc)^2\)</span>.</p></li>
<li><p>Third, Let’s define a reference momentum of the particle <span class="math notranslate nohighlight">\(p_0\)</span>, and each particle will have a deviation from the reference, <span class="math notranslate nohighlight">\(p=p_0(1+\delta)\)</span>.  <span class="math notranslate nohighlight">\(\delta\)</span> is called fractional momentum deviation. We scale the Hamiltonian <span class="math notranslate nohighlight">\(K\)</span> by factor of <span class="math notranslate nohighlight">\(p_0\)</span> and get new <span class="math notranslate nohighlight">\(\tilde{K}\)</span>.</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-fec70867-5035-4c7e-a774-bcecef72b66d">
<span class="eqno">(82)<a class="headerlink" href="#equation-fec70867-5035-4c7e-a774-bcecef72b66d" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{K}{p_0}
&amp;\equiv\tilde{K}\left(x, \tilde{p_x}=\frac{p_x}{p_0}, y, \tilde{p_y}=\frac{p_y}{p_0}, t,-h=\frac{-H}{p_0}\right)\\
&amp;=-\left(1+\frac{x}{\rho}\right)
\sqrt{\left(\frac{h}{c}\right)^2-\left(\frac{mc^2}{p_0}\right)^2-\tilde{p_x}^2-\tilde{p_y}^2}
-e\frac{A_s}{p_0}\left(1+\frac{x}{\rho}\right)
\end{align}\]</div>
<ul class="simple">
<li><p>Last, we will make a canonical transformation from the pair <span class="math notranslate nohighlight">\((t, -h)\)</span> to <span class="math notranslate nohighlight">\((z,\delta)\)</span> with generating function <span class="math notranslate nohighlight">\(F_2=f(\delta)t\)</span> and</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-92059476-6971-4697-ba71-cf018789423b">
<span class="eqno">(83)<a class="headerlink" href="#equation-92059476-6971-4697-ba71-cf018789423b" title="Permalink to this equation">#</a></span>\[\begin{equation}
-h=\frac{\partial F_2}{\partial t}=f(\delta)
\end{equation}\]</div>
<p>The new coordinate <span class="math notranslate nohighlight">\(z\)</span> is calculated as</p>
<div class="amsmath math notranslate nohighlight" id="equation-7effd1e9-8ba8-4c17-81b7-f6d9bac5d94f">
<span class="eqno">(84)<a class="headerlink" href="#equation-7effd1e9-8ba8-4c17-81b7-f6d9bac5d94f" title="Permalink to this equation">#</a></span>\[\begin{align}
z&amp;=\frac{\partial F_2}{\partial \delta} \nonumber \\
&amp;=\left(-\sqrt{c^2(1+\delta)^2+m^2c^4}\right)'t\nonumber \\
&amp;=-\beta ct
\end{align}\]</div>
<p>the Hamiltonian becomes:</p>
<div class="amsmath math notranslate nohighlight" id="equation-96aa11ef-95f9-4547-814d-94a5bc283f8b">
<span class="eqno">(85)<a class="headerlink" href="#equation-96aa11ef-95f9-4547-814d-94a5bc283f8b" title="Permalink to this equation">#</a></span>\[\begin{equation}
\tilde{K}\left(x, \tilde{p_x}, y, \tilde{p_y}, z=-\beta ct, \delta,s\right)=-\left(1+\frac{x}{\rho}\right)\sqrt{(1+\delta)^2-\tilde{p_x}^2-\tilde{p_y}^2} 
-e\frac{A_s}{p_0}\left(1+\frac{x}{\rho}\right)
\end{equation}\]</div>
<p>The new longitudinal coordinate <span class="math notranslate nohighlight">\(z\)</span> has the meaning: the distance of the particle travels at current speed.</p>
<p>For later convenience, we remove the tilde of the above Hamiltonian and it looks like:</p>
<div class="amsmath math notranslate nohighlight" id="equation-666002b1-987f-4b51-a29c-f8a164c4ca66">
<span class="eqno">(86)<a class="headerlink" href="#equation-666002b1-987f-4b51-a29c-f8a164c4ca66" title="Permalink to this equation">#</a></span>\[\begin{equation}
\tilde{K}\left(x, \tilde{p_x}, y, \tilde{p_y}, z=-\beta ct, \delta,s\right)=-\left(1+\frac{x}{\rho}\right)\sqrt{(1+\delta)^2-\tilde{p_x}^2-\tilde{p_y}^2} 
-e\frac{A_s}{p_0}\left(1+\frac{x}{\rho}\right)\label{eq:Hamiltonian_popular_form}
\end{equation}\]</div>
</section>
<section id="further-assumptions">
<h3>Further assumptions<a class="headerlink" href="#further-assumptions" title="Link to this heading">#</a></h3>
<p>The above Hamiltonian can be consider as exact in most accelerator cases.  Next, we will make assumptions and expand the Hamiltonian up to 2nd order.  The assumptions includes:</p>
<ul class="simple">
<li><p>Momentum spread is very small. For any particle, <span class="math notranslate nohighlight">\(\delta \ll 1\)</span></p></li>
<li><p>Paraxial approximation, the longitudinal momentum is close to the reference momentum and <span class="math notranslate nohighlight">\(p_x,p_y \ll 1\)</span></p></li>
</ul>
<p>Then we can expand the Hamiltonian up to 2nd order in <span class="math notranslate nohighlight">\(p_x\)</span> and <span class="math notranslate nohighlight">\(p_y\)</span> and have:</p>
<div class="amsmath math notranslate nohighlight" id="equation-5333515b-1f03-427d-8db7-0b2387b5e70c">
<span class="eqno">(87)<a class="headerlink" href="#equation-5333515b-1f03-427d-8db7-0b2387b5e70c" title="Permalink to this equation">#</a></span>\[\begin{align}
K\left(x, p_x, y, p_y, z, \delta,s\right)&amp;=-(1+\delta)\left(1+\frac{x}{\rho}\right)\left(1-\frac{p_x^2}{2(1+\delta)^2}-\frac{p_y^2}{2(1+\delta)^2}\right)
-e\frac{A_s}{p_0}\left(1+\frac{x}{\rho}\right)   \nonumber\\
&amp;=-\left(1+\frac{x}{\rho}\right)\left(1+\delta-\frac{p_x^2}{2(1+\delta)}-\frac{p_y^2}{2(1+\delta)}\right)
-e\frac{A_s}{p_0}\left(1+\frac{x}{\rho}\right)
\end{align}\]</div>
<p>Recall that
$<span class="math notranslate nohighlight">\(p_x=\frac{\mathbf{p}\cdot\hat{x}}{p_0} \;;\; p_y=\frac{\mathbf{p}\cdot\hat{y}}{p_0}\)</span>$</p>
<p>is different from the orbit slope:</p>
<div class="amsmath math notranslate nohighlight" id="equation-8dd8bb3b-5171-4594-abbc-649778d39bfd">
<span class="eqno">(88)<a class="headerlink" href="#equation-8dd8bb3b-5171-4594-abbc-649778d39bfd" title="Permalink to this equation">#</a></span>\[\begin{equation}
x^\prime\equiv\frac{dx}{ds}=\frac{\mathbf{p}\cdot\hat{x}}{p_s}\sim\frac{\mathbf{p}\cdot\hat{x}}{p_0(1+\delta)}=\frac{p_x}{1+\delta}
\end{equation}\]</div>
<div class="amsmath math notranslate nohighlight" id="equation-ed9c1cee-0c59-4f69-ab2c-04cf5885e231">
<span class="eqno">(89)<a class="headerlink" href="#equation-ed9c1cee-0c59-4f69-ab2c-04cf5885e231" title="Permalink to this equation">#</a></span>\[\begin{equation}
y^\prime\equiv\frac{dy}{ds}=\frac{\mathbf{p}\cdot\hat{y}}{p_s}\sim\frac{\mathbf{p}\cdot\hat{y}}{p_0(1+\delta)}=\frac{p_y}{1+\delta}
\end{equation}\]</div>
<p>Therefore, we only consider the transverse motion without energy dependence, the slope <span class="math notranslate nohighlight">\(x^\prime\)</span> and <span class="math notranslate nohighlight">\(y^\prime\)</span> can be used as conjugate momentum in paraxial approximation.  Otherwise using the slope instead of <span class="math notranslate nohighlight">\(p_x\)</span> and <span class="math notranslate nohighlight">\(p_y\)</span> will violate Hamiltonian dynamics.</p>
<p>In 4-Dimensional motion for particle with reference momentum, the Hamiltonian is</p>
<div class="amsmath math notranslate nohighlight" id="equation-e496f6f6-d3e5-422b-8dae-1382e69f4180">
<span class="eqno">(90)<a class="headerlink" href="#equation-e496f6f6-d3e5-422b-8dae-1382e69f4180" title="Permalink to this equation">#</a></span>\[\begin{equation}
K\left(x, p_x, y, p_y,s\right)=-\left(1+\frac{x}{\rho}\right)\left(1-\frac{p_x^2}{2}-\frac{p_y^2}{2}\right)
-e\frac{A_s}{p_0}\left(1+\frac{x}{\rho}\right)   
\end{equation}\]</div>
</section>
<section id="vector-potentials-for-linear-elements">
<h3>Vector potentials for linear elements<a class="headerlink" href="#vector-potentials-for-linear-elements" title="Link to this heading">#</a></h3>
<p>Now, its time to consider the real form for the vector potential <span class="math notranslate nohighlight">\(A_s\)</span>.  We will limit our discussion within linear regime.</p>
<p>For a main dipole, where the reference orbit bend inside with radius <span class="math notranslate nohighlight">\(\rho\)</span> or its reciprocal, curvature <span class="math notranslate nohighlight">\(\kappa=1/\rho\)</span>, we need to find <span class="math notranslate nohighlight">\(A_s\)</span> to get vertical magnetic field <span class="math notranslate nohighlight">\(\mathbf{B}=B_0(s)\hat{y}\)</span> in the Frenet-Serret coordinate system:</p>
<div class="amsmath math notranslate nohighlight" id="equation-3e8b5f1d-a89f-4576-b587-354c179662aa">
<span class="eqno">(91)<a class="headerlink" href="#equation-3e8b5f1d-a89f-4576-b587-354c179662aa" title="Permalink to this equation">#</a></span>\[\begin{equation}
B_0(s)=-\frac{1}{1+\kappa x}\frac{\partial\left((1+\kappa x)A_s\right)}{\partial x}
\end{equation}\]</div>
<p>It seems exact solution for this differential equation doesnot exist.  However, with the assumption of <span class="math notranslate nohighlight">\(\left|x\right|\kappa \ll 1\)</span>, we can get approximation of <span class="math notranslate nohighlight">\(A_s\)</span> up to second order.  Let’s assume <span class="math notranslate nohighlight">\(A_s=-B_0(s)(a x + bx^2)\)</span>.  Then we get:</p>
<div class="amsmath math notranslate nohighlight" id="equation-72cbaea3-58b2-4d98-b3fa-7bff08f2e7bc">
<span class="eqno">(92)<a class="headerlink" href="#equation-72cbaea3-58b2-4d98-b3fa-7bff08f2e7bc" title="Permalink to this equation">#</a></span>\[\begin{equation}
1+\kappa x=\frac{\partial\left((1+\kappa x)(ax+bx^2)\right)}{\partial x}
\end{equation}\]</div>
<p>By solve the index of the <span class="math notranslate nohighlight">\(0^{th}\)</span> and <span class="math notranslate nohighlight">\(1^{th}\)</span> terms, we get <span class="math notranslate nohighlight">\(a=1\)</span> and <span class="math notranslate nohighlight">\(b=-\kappa/2\)</span>.   Therefore in a constant field main dipole:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b60d6eb3-4a67-430d-9b10-2465771d8cfd">
<span class="eqno">(93)<a class="headerlink" href="#equation-b60d6eb3-4a67-430d-9b10-2465771d8cfd" title="Permalink to this equation">#</a></span>\[\begin{equation}
A_{s,d}\approx-B_0\left(x - \frac{x^2}{2\rho}\right)
\end{equation}\]</div>
<p>For quadrupole, the radius is infinity.  The vector potential will be the same as its form in a Cartesian coordinate.  From the Beth’s representation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-66128853-6c35-4ac7-9c73-d9abda0174ec">
<span class="eqno">(94)<a class="headerlink" href="#equation-66128853-6c35-4ac7-9c73-d9abda0174ec" title="Permalink to this equation">#</a></span>\[\begin{equation}
A_{s,q}=-B_0 b_1(s) \left(x^2-y^2\right)/2=-G(s)\left(x^2-y^2\right)/2
\end{equation}\]</div>
<p>Here <span class="math notranslate nohighlight">\(G(s)\)</span> is the field gradient in unit of [Tesla/m].</p>
<p>We get the Hamiltonian and truncate down to second order, and recall that the rigidity <span class="math notranslate nohighlight">\(B_0 \rho=p_0/e\)</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-ea00b373-fa1e-46b9-bdef-02e151e865a4">
<span class="eqno">(95)<a class="headerlink" href="#equation-ea00b373-fa1e-46b9-bdef-02e151e865a4" title="Permalink to this equation">#</a></span>\[\begin{align}
K\left(x, p_x, y, p_y,s\right)&amp;=-\left(1+\frac{x}{\rho}\right)\left(1-\frac{p_x^2}{2}-\frac{p_y^2}{2}\right)
+\frac{eB_0}{p_0}\left(1+\frac{x}{\rho}\right)\left(x-\frac{x^2}{2\rho}\right)+\frac{eB_0b_1}{2p_0}\left(x^2-y^2\right) \nonumber\\
&amp;=-\left(1+\frac{x}{\rho}\right)\left(1-\frac{p_x^2}{2}-\frac{p_y^2}{2}\right)
+\frac{1}{\rho}\left(1+\frac{x}{\rho}\right)\left(x-\frac{x^2}{2\rho}\right)+\frac{G(s)}{2B_0\rho}\left(x^2-y^2\right) \nonumber\\
&amp;\approx -1+\frac{p_x^2}{2}+\frac{p_y^2}{2}+\frac{x^2}{2\rho^2}+k(s)\left(x^2-y^2\right)/2
\end{align}\]</div>
<p>Here we use normalized quadrupole strength <span class="math notranslate nohighlight">\(k(s)=G(s)/B_0\rho\)</span>.  It is the most useful quantity in the simulation to characterize the strength of a quadrupole.</p>
<p>In the approximate Hamiltonian of dipole and normal quadrupole, we can first ignore the constant, then split it in to two separate Hamiltonian, one for each transverse direction.
$<span class="math notranslate nohighlight">\(K\left(x, p_x, y, p_y,s\right)=K_x\left(x, p_x,s\right)+K_y\left( y, p_y,s\right)\)</span>$
This indicate that the motion of two directions are de-coupled and can be treat separately.</p>
<div class="amsmath math notranslate nohighlight" id="equation-de11037e-03ad-4cc5-acbf-94122a0903a9">
<span class="eqno">(96)<a class="headerlink" href="#equation-de11037e-03ad-4cc5-acbf-94122a0903a9" title="Permalink to this equation">#</a></span>\[\begin{align}
K_x\left(x,p_x,s\right)&amp;=\frac{p_x^2}{2}+\frac{x^2}{2\rho^2}+\frac{k(s)x^2}{2} \\
K_y\left(y,p_y,s\right)&amp;=\frac{p_y^2}{2}-\frac{k(s)y^2}{2}
\end{align}\]</div>
<p>The equations of motion can be found from Hamiltonian equation:</p>
<div class="amsmath math notranslate nohighlight" id="equation-ec076d2c-8c90-45fd-a743-3524ba51afdb">
<span class="eqno">(97)<a class="headerlink" href="#equation-ec076d2c-8c90-45fd-a743-3524ba51afdb" title="Permalink to this equation">#</a></span>\[\begin{align}
&amp; x''+\left(\frac{1}{\rho^2}+k(s)\right)x=0 \\
&amp; y''-k(s)y=0
\end{align}\]</div>
<p>We returned to the Hill’s equation including both the main dipole and quadrupole in the Frenet-Serret coordinate system.</p>
<p>Combine the effect of dipole and quad, there is an chance to have focusing effect in both plane:</p>
<div class="amsmath math notranslate nohighlight" id="equation-082f4727-87de-4776-aad4-e2d23a1439f9">
<span class="eqno">(98)<a class="headerlink" href="#equation-082f4727-87de-4776-aad4-e2d23a1439f9" title="Permalink to this equation">#</a></span>\[\begin{align}
-\frac{1}{\rho^2}&lt;k(s)&lt;0
\end{align}\]</div>
<p>If a machine can have this condition through out, the motion of both transverse plane will be stable.  This is called <strong>weak focusing</strong>.</p>
</section>
</section>
<section id="transfer-matrix-for-linear-elements">
<h2>Transfer Matrix for Linear Elements<a class="headerlink" href="#transfer-matrix-for-linear-elements" title="Link to this heading">#</a></h2>
<p>It is convenient to write the solution of the Hill’s equation using matrix form.  Such matrix is named betatron transfer matrix.  The motion in each transverse direction can be described by <span class="math notranslate nohighlight">\(2\times 2\)</span> matrix.</p>
<section id="drift-space">
<h3>Drift space<a class="headerlink" href="#drift-space" title="Link to this heading">#</a></h3>
<p>The EOM for drift space is simply <span class="math notranslate nohighlight">\(x''=0\)</span> and <span class="math notranslate nohighlight">\(y''=0\)</span>.  Using horizontal direction as instance, if the initial condition at the starting point <span class="math notranslate nohighlight">\(s_0\)</span> are <span class="math notranslate nohighlight">\(x(s=s_0)=x_0\)</span> and <span class="math notranslate nohighlight">\(x'(s=s_0)={x_0'}\)</span>.  The solution is:</p>
<div class="amsmath math notranslate nohighlight" id="equation-9662fdbd-3323-4431-b847-171be3451f9b">
<span class="eqno">(99)<a class="headerlink" href="#equation-9662fdbd-3323-4431-b847-171be3451f9b" title="Permalink to this equation">#</a></span>\[\begin{equation}
x(s=s_0+l)=x_0+x'_0l
\end{equation}\]</div>
<p>Or in matrix form</p>
<div class="amsmath math notranslate nohighlight" id="equation-cc849b81-9f2c-4718-9a0a-0225b3eb1116">
<span class="eqno">(100)<a class="headerlink" href="#equation-cc849b81-9f2c-4718-9a0a-0225b3eb1116" title="Permalink to this equation">#</a></span>\[\begin{equation}
\left(\begin{array}{c}
x\\
x'
\end{array}\right)_{s=s_0+l}=\left(\begin{array}{cc}
1 &amp; l\\
0 &amp; 1
\end{array}\right)\left(\begin{array}{c}
x\\
x
\end{array}\right)_{s=s_0}
\end{equation}\]</div>
<p>We write the transfer matrix for drift space as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-d7d57be5-310c-4b0a-9e95-73538278a511">
<span class="eqno">(101)<a class="headerlink" href="#equation-d7d57be5-310c-4b0a-9e95-73538278a511" title="Permalink to this equation">#</a></span>\[\begin{equation}M\left(s_0+s,s_0\right)=\left(\begin{array}{cc}
1 &amp; s\\
0 &amp; 1
\end{array}\right)
\end{equation}\]</div>
</section>
<section id="dipole-main">
<h3>Dipole (main)<a class="headerlink" href="#dipole-main" title="Link to this heading">#</a></h3>
<p>For the dipole that bend the beam with the radius <span class="math notranslate nohighlight">\(\rho\)</span> in horizontal plane, the <span class="math notranslate nohighlight">\(x\)</span> direction follows an EOM as a harmonic oscillator, while in <span class="math notranslate nohighlight">\(y\)</span> direction, the motion is just as in a drift space.</p>
<p>The matrix form in the dipole can be easily get as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-cd07cdda-5b4f-4f65-8c72-117a9f5e25ee">
<span class="eqno">(102)<a class="headerlink" href="#equation-cd07cdda-5b4f-4f65-8c72-117a9f5e25ee" title="Permalink to this equation">#</a></span>\[\begin{equation}
\left(\begin{array}{c}
x\\
x'
\end{array}\right)_{s=s_0+l}=\left(\begin{array}{cc}
\cos(l/\rho) &amp; \rho\sin(l/\rho)\\
-\sin(l/\rho)/\rho &amp; \cos(l/\rho)
\end{array}\right)\left(\begin{array}{c}
x\\
x
\end{array}\right)_{s=s_0}
\end{equation}\]</div>
<p>The transfer matrix for dipole in horizontal space is:</p>
<div class="amsmath math notranslate nohighlight" id="equation-5760020b-7cbd-47a8-9b17-b9146a7f090c">
<span class="eqno">(103)<a class="headerlink" href="#equation-5760020b-7cbd-47a8-9b17-b9146a7f090c" title="Permalink to this equation">#</a></span>\[\begin{equation}
M\left(s_0+l,s_0\right)=\left(\begin{array}{cc}
\cos\left(\frac{l}{\rho}\right) &amp; \rho\sin\left(\frac{l}{\rho}\right)\\
-\frac{1}{\rho}\sin\left(\frac{l}{\rho}\right) &amp; \cos\left(\frac{l}{\rho}\right)
\end{array}\right)
\end{equation}\]</div>
<p>In a small angle approximation <span class="math notranslate nohighlight">\(l/\rho \ll1\)</span>, we can expand the matrix up to first order of <span class="math notranslate nohighlight">\(l/\rho\)</span>.  The matrix reduce to a drift space:</p>
<div class="amsmath math notranslate nohighlight" id="equation-efab05f4-4d10-4e28-a5d8-8e5e78fdc206">
<span class="eqno">(104)<a class="headerlink" href="#equation-efab05f4-4d10-4e28-a5d8-8e5e78fdc206" title="Permalink to this equation">#</a></span>\[\begin{equation}
M\left(s_0+l,s_0\right)=\left(\begin{array}{cc}
1 &amp; l\\
0 &amp; 1
\end{array}\right)
\end{equation}\]</div>
</section>
<section id="quadrupole-normal">
<h3>Quadrupole (Normal)<a class="headerlink" href="#quadrupole-normal" title="Link to this heading">#</a></h3>
<p>In the example before, we already derived the solution for particle in the quadrupole.  It can be rewritten in the matrix form as</p>
<div class="amsmath math notranslate nohighlight" id="equation-840fc51a-9e08-410b-bd33-520afa1448ac">
<span class="eqno">(105)<a class="headerlink" href="#equation-840fc51a-9e08-410b-bd33-520afa1448ac" title="Permalink to this equation">#</a></span>\[\begin{equation}
M\left(s_0+s,s_0\right)=
\begin{cases}
\left(\begin{array}{cc}
\cos\left(\sqrt{k}s\right) &amp; \sin\left(\sqrt{k}s\right)/\sqrt{k}\\
-\sqrt{k}\sin\left(\sqrt{k}s\right) &amp; \cos\left(\sqrt{k}s\right)
\end{array}\right)&amp;k&gt;0, \text{Focusing Quad}\\
\\
\left(\begin{array}{cc}
\cosh\left(\sqrt{-k}s\right) &amp; \sinh\left(\sqrt{-k}s\right)/\sqrt{-k}\\
\sqrt{k}\sinh\left(\sqrt{-k}s\right) &amp; \cosh\left(\sqrt{-k}s\right)
\end{array}\right)&amp;k&lt;0, \text{Defocusing Quad}\\
\end{cases}
\end{equation}\]</div>
<p>Usually, the quadrupole has short length and strong field gradient. We may model such short quad as a ‘lens with zero length’, and define the focal length <span class="math notranslate nohighlight">\(f\)</span> as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-33e55bf6-d159-40d5-a5fe-34e2c63cacd6">
<span class="eqno">(106)<a class="headerlink" href="#equation-33e55bf6-d159-40d5-a5fe-34e2c63cacd6" title="Permalink to this equation">#</a></span>\[\begin{equation}
f=\lim_{l\to 0}\frac{1}{|k|l}
\end{equation}\]</div>
<p>In such limit the transfer map for a thin-length quad is</p>
<div class="amsmath math notranslate nohighlight" id="equation-ff31056b-c9c6-4258-8c30-98b9a036fa5f">
<span class="eqno">(107)<a class="headerlink" href="#equation-ff31056b-c9c6-4258-8c30-98b9a036fa5f" title="Permalink to this equation">#</a></span>\[\begin{equation}
M_{\text{quad}}=
\begin{cases}
\left(\begin{array}{cc}
1 &amp; 0\\
-1/f &amp; 1
\end{array}\right)&amp; \text{Focusing Quad}\\
\\
\left(\begin{array}{cc}
1 &amp; 0\\
1/f &amp; 1
\end{array}\right)&amp; \text{Defocusing Quad}\\
\end{cases}
\end{equation}\]</div>
</section>
<section id="chain-of-linear-elements">
<h3>Chain of linear elements<a class="headerlink" href="#chain-of-linear-elements" title="Link to this heading">#</a></h3>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../../_images/chain_of_elements.png"><img alt="../../_images/chain_of_elements.png" src="../../_images/chain_of_elements.png" style="width: 513.0px; height: 147.0px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 19 </span><span class="caption-text">A cartoon of accelerator lattice</span><a class="headerlink" href="#id4" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In accelerators, we have chain of magnets, as illustrated above.  Each magnet has a transfer matrix, the transfer matrix for the chain can be found by matrix multiplications:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b248408b-55d7-4784-b7c0-aac1b343391e">
<span class="eqno">(108)<a class="headerlink" href="#equation-b248408b-55d7-4784-b7c0-aac1b343391e" title="Permalink to this equation">#</a></span>\[\begin{equation}
M\left(s_n,s_0\right)=M\left(s_n,s_{n-1}\right)\cdots M\left(s_2,s_1\right)M\left(s_1,s_0\right)
\end{equation}\]</div>
<p>Note that the order of the multiplication is the reverse order of the placement of the magnet.</p>
</section>
<section id="properties-of-the-betatron-transfer-matrix">
<h3>Properties of the betatron transfer matrix<a class="headerlink" href="#properties-of-the-betatron-transfer-matrix" title="Link to this heading">#</a></h3>
<section id="symplectic-condition">
<h4>Symplectic condition<a class="headerlink" href="#symplectic-condition" title="Link to this heading">#</a></h4>
<p>Let’s return to the most general form of the matrix <span class="math notranslate nohighlight">\(M\)</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-53ff6716-a7ce-4a40-81b8-d42af99f7a73">
<span class="eqno">(109)<a class="headerlink" href="#equation-53ff6716-a7ce-4a40-81b8-d42af99f7a73" title="Permalink to this equation">#</a></span>\[\begin{equation}
M(s)=\left(\begin{array}{cc}
a(s) &amp; b(s)\\
c(s) &amp; d(s)
\end{array}\right)
\end{equation}\]</div>
<p>The matrix represent the solution:</p>
<div class="amsmath math notranslate nohighlight" id="equation-5c983f87-ee4f-46a5-9f59-2adc95b1ca75">
<span class="eqno">(110)<a class="headerlink" href="#equation-5c983f87-ee4f-46a5-9f59-2adc95b1ca75" title="Permalink to this equation">#</a></span>\[\begin{align}
x(s)&amp;=x_0a(s)+x'_0b(s)\\
x'(s)&amp;=x_0c(s)+x'_0d(s)
\end{align}\]</div>
<p>that satisfy the Hill’s equation with general focusing term <span class="math notranslate nohighlight">\(K(s)\)</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-50569fff-beaf-4cc0-9d13-390e4d38cd25">
<span class="eqno">(111)<a class="headerlink" href="#equation-50569fff-beaf-4cc0-9d13-390e4d38cd25" title="Permalink to this equation">#</a></span>\[\begin{equation}
x''+K(s)x=0
\end{equation}\]</div>
<p>It can be constructed from the Hamiltonian, which reads:</p>
<div class="amsmath math notranslate nohighlight" id="equation-38d7fd6e-f2ee-4a67-a3fe-f5c7a4a50eff">
<span class="eqno">(112)<a class="headerlink" href="#equation-38d7fd6e-f2ee-4a67-a3fe-f5c7a4a50eff" title="Permalink to this equation">#</a></span>\[\begin{equation}
H(x,x')=x'^2+K(s)x^2
\end{equation}\]</div>
<p>The implicit requirement raised from fact that the system is described by a Hamiltonian is called <em><strong>symplecticity</strong></em>.  The symplectic property for a 1-D system is the simplest case.
To review this property, we use the concept of Wronskian of differential equation.  For 1-D second order ODE, there aways exist 2 independent solution.  We name it <span class="math notranslate nohighlight">\(x_1(s)\)</span> and <span class="math notranslate nohighlight">\(x_2(s)\)</span>.
Wronskian is defined as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-a2776993-8acb-41bd-a50c-fc015c83e5b7">
<span class="eqno">(113)<a class="headerlink" href="#equation-a2776993-8acb-41bd-a50c-fc015c83e5b7" title="Permalink to this equation">#</a></span>\[\begin{equation}
W\equiv det(\mathbf{X}) = det \left(\begin{array}{cc}
x_{1} &amp; x_{2}\\
x'_{1} &amp; x'_{2}
\end{array}\right)
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> is known as the fundamental matrix.  The derivative of Wronskian reads</p>
<div class="amsmath math notranslate nohighlight" id="equation-8206a5ca-c5b8-41e3-90ba-b70c90cdbdd4">
<span class="eqno">(114)<a class="headerlink" href="#equation-8206a5ca-c5b8-41e3-90ba-b70c90cdbdd4" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{dW}{ds}&amp;=x'_1x'_2+x_1x''_2-x'_2x'_1-x_2x''_1  \nonumber\\
&amp;=-K(s)x_1x_2+K(s)x_2x_1 \nonumber\\
&amp;=0
\end{align}\]</div>
<p>Therefore Wronskian is the constant of motion and not zero(the two solution are indepedent).</p>
<p>Then from the definition of the fundamental matrix:</p>
<div class="amsmath math notranslate nohighlight" id="equation-8b219057-5a44-4fa4-bc24-30d510a164d7">
<span class="eqno">(115)<a class="headerlink" href="#equation-8b219057-5a44-4fa4-bc24-30d510a164d7" title="Permalink to this equation">#</a></span>\[\begin{equation}
\left(\begin{array}{cc}
x_{1} &amp; x_{2}\\
x'_{1} &amp; x'_{2}
\end{array}\right)_{s=s_{0}+s}=\left(\begin{array}{cc}
a(s) &amp; b(s)\\
c(s) &amp; d(s)
\end{array}\right)\left(\begin{array}{cc}
x_{1} &amp; x_{2}\\
x'_{1} &amp; x'_{2}
\end{array}\right)_{s=s_{0}}
\end{equation}\]</div>
<p>Take the determinant on both sides, we have</p>
<div class="amsmath math notranslate nohighlight" id="equation-5f48af03-5837-4baa-9c74-66419d323a53">
<span class="eqno">(116)<a class="headerlink" href="#equation-5f48af03-5837-4baa-9c74-66419d323a53" title="Permalink to this equation">#</a></span>\[\begin{equation}
W(s_0+s)=det(M(s_0+s,s_0))W(s)
\end{equation}\]</div>
<p>Since <span class="math notranslate nohighlight">\(W(s)\)</span> is constant of motion, therefore <em><strong>the determinant of transfer matrix is always 1</strong></em>.  This is a sufficient and necessary condition of symplecticity for 1-D system.  We will learn later, in multi-dimension problem, this is still a necessary condition but not sufficient anymore.</p>
</section>
<section id="long-term-stability-condition">
<h4>Long-term stability condition<a class="headerlink" href="#long-term-stability-condition" title="Link to this heading">#</a></h4>
<p>The symplecticity ensures the area phase space is constant.  However, in most times, we have stronger requirements for a repeating chain of elements.</p>
<p>In accelerator, the beam usually will pass through a chain of elements (called cell) many times.  A long lattice usually consist of repeating cells.  In a ring accelerator, the particle will travels through the lattice billions of turns.  If the transfer matrix for one cell is <span class="math notranslate nohighlight">\(M\)</span>, we are interested in the behavior of repeating <span class="math notranslate nohighlight">\(k\)</span> cells</p>
<div class="math notranslate nohighlight">
\[M_{total}=M\cdot M\cdots M\cdot M=M^k\]</div>
<p>where k is a very large integer or infinity.</p>
<p>To avoid the either <span class="math notranslate nohighlight">\(x\)</span> or <span class="math notranslate nohighlight">\(x'\)</span> to be very large (or infinity) after k cells. We required that the absolute value of the eigenvalues of <span class="math notranslate nohighlight">\(M\)</span> is no larger than 1.  The eigenvalue is found by:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b89c42b9-0841-4216-9f72-c82d4a26e5d5">
<span class="eqno">(117)<a class="headerlink" href="#equation-b89c42b9-0841-4216-9f72-c82d4a26e5d5" title="Permalink to this equation">#</a></span>\[\begin{equation}
\left|\begin{array}{cc}
\lambda-a &amp; -b\\
-c &amp; \lambda-d
\end{array}\right|=0
\end{equation}\]</div>
<p>or</p>
<div class="amsmath math notranslate nohighlight" id="equation-b00fe2a1-acb8-4485-b225-dbadf1aebb26">
<span class="eqno">(118)<a class="headerlink" href="#equation-b00fe2a1-acb8-4485-b225-dbadf1aebb26" title="Permalink to this equation">#</a></span>\[\begin{equation}
\lambda^2-(a+d)\lambda+1=0
\end{equation}\]</div>
<p>To satisfy <span class="math notranslate nohighlight">\(|\lambda|\le 1\)</span>, we require</p>
<div class="amsmath math notranslate nohighlight" id="equation-5b6226fd-5d19-4209-b482-6d350ade4d1b">
<span class="eqno">(119)<a class="headerlink" href="#equation-5b6226fd-5d19-4209-b482-6d350ade4d1b" title="Permalink to this equation">#</a></span>\[\begin{equation}
\left|Tr(M)\right|=\left|a+d\right|\le 2
\end{equation}\]</div>
<p>This is the stable condition for one cell in periodical structure.</p>
</section>
</section>
<section id="revisit-the-weak-focusing">
<h3>Revisit, the ‘weak focusing’<a class="headerlink" href="#revisit-the-weak-focusing" title="Link to this heading">#</a></h3>
<figure class="align-right" id="id5">
<a class="reference internal image-reference" href="../../_images/weak_focusing.png"><img alt="../../_images/weak_focusing.png" src="../../_images/weak_focusing.png" style="width: 181.60000000000002px; height: 180.8px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">An ideal weak focusing ring</span><a class="headerlink" href="#id5" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Let us consider an accelerator, built by one type of combine function magnet that is stable in both transverse deirections. This is named later as ‘weak focusing’.   The weak focusing satisfies:</p>
<div class="amsmath math notranslate nohighlight" id="equation-d92daeb6-a648-43aa-9062-d34d05d23151">
<span class="eqno">(120)<a class="headerlink" href="#equation-d92daeb6-a648-43aa-9062-d34d05d23151" title="Permalink to this equation">#</a></span>\[\begin{align}
x''+k_x(s)x&amp;=0 \\
y''+k_y(s)y&amp;=0
\end{align}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(k_x(s)\)</span> and <span class="math notranslate nohighlight">\(k_y(s)\)</span> are piece wise constant and always positive, and <span class="math notranslate nohighlight">\(k_x(s)+k_y(s)=1/\rho ^2\)</span>.</p>
<p>We can write the matrix term for the weak focusing as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-ce562494-49a1-4176-bbd0-9dbdfda32b6e">
<span class="eqno">(121)<a class="headerlink" href="#equation-ce562494-49a1-4176-bbd0-9dbdfda32b6e" title="Permalink to this equation">#</a></span>\[\begin{align}
M_x\left(s_0+s,s_0\right)
&amp;=\left(\begin{array}{cc}
\cos\left(\sqrt{k_x}s\right) &amp; \sin\left(\sqrt{k_x}s\right)/\sqrt{k_x}\\
-\sqrt{k_x}\sin\left(\sqrt{k_x}s\right) &amp; \cos\left(\sqrt{k_x}s\right)
\end{array}\right)\\
M_y\left(s_0+s,s_0\right)
&amp;=\left(\begin{array}{cc}
\cos\left(\sqrt{k_y}s\right) &amp; \sin\left(\sqrt{k_y}s\right)/\sqrt{k_y}\\
-\sqrt{k_y}\sin\left(\sqrt{k_y}s\right) &amp; \cos\left(\sqrt{k_y}s\right)
\end{array}\right)
\end{align}\]</div>
<p>The matrix indicates that except a scaling factor, the transfer matrix is just a rotation of the phase space.  If we define <span class="math notranslate nohighlight">\(P_x=x'/\sqrt{k_x}\)</span> and <span class="math notranslate nohighlight">\(P_y=y'/\sqrt{k_y}\)</span>, the transfer matrix for <span class="math notranslate nohighlight">\((x,P_x)\)</span>, <span class="math notranslate nohighlight">\((y,P_y)\)</span> are just rotation matrix with angle <span class="math notranslate nohighlight">\(\sqrt{k_{x/y}}s\)</span> respectively.  Then we call the angle <strong>betatron phase advance</strong>.</p>
<p>If we have an entire ring, made of weak focusing structure as shown above, the matrix for entire ring gives:</p>
<div class="amsmath math notranslate nohighlight" id="equation-c6131107-3965-47f5-baad-56720842213e">
<span class="eqno">(122)<a class="headerlink" href="#equation-c6131107-3965-47f5-baad-56720842213e" title="Permalink to this equation">#</a></span>\[\begin{align}
M_x\left(s_0+C,s_0\right)
&amp;=\left(\begin{array}{cc}
\cos\left(\sqrt{k_x}2\pi\rho\right) &amp; \sin\left(\sqrt{k_x}2\pi\rho\right)/\sqrt{k_x}\\
-\sqrt{k_x}\sin\left(\sqrt{k_x}2\pi\rho\right) &amp; \cos\left(\sqrt{k_x}2\pi\rho\right)
\end{array}\right)\\
M_y\left(s_0+C,s_0\right)
&amp;=\left(\begin{array}{cc}
\cos\left(\sqrt{k_y}2\pi\rho\right) &amp; \sin\left(\sqrt{k_y}2\pi\rho\right)/\sqrt{k_y}\\
-\sqrt{k_y}\sin\left(\sqrt{k_y}2\pi\rho\right) &amp; \cos\left(\sqrt{k_y}2\pi\rho\right)
\end{array}\right)
\end{align}\]</div>
<p>It means, after one turn the phase advance of the two transverse plane is just <span class="math notranslate nohighlight">\(2\pi\sqrt{k_{x/y}}\rho\)</span>.  We define the transverse tune <span class="math notranslate nohighlight">\(\nu_{x/y}\)</span> is the one turn phase advance in unit of <span class="math notranslate nohighlight">\(2\pi\)</span>.  Therefore:</p>
<div class="amsmath math notranslate nohighlight" id="equation-7121197c-165d-43e7-96a1-d15532248822">
<span class="eqno">(123)<a class="headerlink" href="#equation-7121197c-165d-43e7-96a1-d15532248822" title="Permalink to this equation">#</a></span>\[\begin{align}
\nu_x&amp;=\sqrt{k_{x}}\rho=\sqrt{1+\rho^2 k}\\
\nu_y&amp;=\sqrt{k_{y}}\rho=\sqrt{-k}\rho
\end{align}\]</div>
<figure class="align-left" id="id6">
<a class="reference internal image-reference" href="../../_images/weak_focusing_drift.png"><img alt="../../_images/weak_focusing_drift.png" src="../../_images/weak_focusing_drift.png" style="width: 190.8px; height: 190.8px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 21 </span><span class="caption-text">A ‘realistic’ weak focusing ring</span><a class="headerlink" href="#id6" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>For continuous weak-focusing ring, we always have:</p>
<div class="amsmath math notranslate nohighlight" id="equation-3d26f1db-84bc-411e-91ac-aceb8cad0a82">
<span class="eqno">(124)<a class="headerlink" href="#equation-3d26f1db-84bc-411e-91ac-aceb8cad0a82" title="Permalink to this equation">#</a></span>\[\begin{align}
\nu_x^2+\nu_y^2=1
\end{align}\]</div>
<p>We may also look at the weak focusing ring is made of several sections with small drift space <span class="math notranslate nohighlight">\(L\)</span> in between.  This is a more realistic case, since we need non-magnetic region for injection/extraction, acceleration, and beam diagnostics devices.</p>
<p>We consider a segament, starting and ending at the middle of the drift space, whose transfer matrix is represented as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-75f829b1-3b82-4f51-b067-f57b9f5ecb62">
<span class="eqno">(125)<a class="headerlink" href="#equation-75f829b1-3b82-4f51-b067-f57b9f5ecb62" title="Permalink to this equation">#</a></span>\[\begin{align}
M_{x,seg}
&amp;=\left(\begin{array}{cc}
1 &amp; L/2\\
0 &amp; 1
\end{array}\right)
\left(\begin{array}{cc}
\cos\left(\sqrt{k_x}s\right) &amp; \sin\left(\sqrt{k_x}s\right)/\sqrt{k_x}\\
-\sqrt{k_x}\sin\left(\sqrt{k_x}s\right) &amp; \cos\left(\sqrt{k_x}s\right)
\end{array}\right)
\left(\begin{array}{cc}
1 &amp; L/2\\
0 &amp; 1
\end{array}\right)\\
\end{align}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sympy</span>
<span class="n">sympy</span><span class="o">.</span><span class="n">init_printing</span><span class="p">(</span><span class="n">use_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sqkx</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">l</span><span class="o">=</span><span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;\sqrt</span><span class="si">{k_x}</span><span class="s2">,s,L&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">mat_f</span><span class="p">(</span><span class="n">sqk</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([[</span><span class="n">sympy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sqk</span><span class="o">*</span><span class="n">s</span><span class="p">),</span><span class="n">sympy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sqk</span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">sqk</span><span class="p">],</span>
                         <span class="p">[</span><span class="o">-</span><span class="n">sympy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sqk</span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">sqk</span><span class="p">,</span><span class="n">sympy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sqk</span><span class="o">*</span><span class="n">s</span><span class="p">)]])</span>
<span class="k">def</span> <span class="nf">mat_d</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="n">d</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">mat_seg</span><span class="o">=</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">mat_d</span><span class="p">(</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">mat_f</span><span class="p">(</span><span class="n">sqkx</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">mat_d</span><span class="p">(</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<span class="n">mat_seg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0600af99c57822b1369f12a2115ca534eea6080235a434fe4c88c6580611d106.png" src="../../_images/0600af99c57822b1369f12a2115ca534eea6080235a434fe4c88c6580611d106.png" />
</div>
</div>
<p>When <span class="math notranslate nohighlight">\(L\sqrt{k_x}\ll1\)</span>, the diagnal terms can be written as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-58afaca7-b5b0-4ffb-a4bd-91673d5446e2">
<span class="eqno">(126)<a class="headerlink" href="#equation-58afaca7-b5b0-4ffb-a4bd-91673d5446e2" title="Permalink to this equation">#</a></span>\[\begin{align}
M_{11}=M_{22}
&amp;=\cos\left(\sqrt{k_x}s + \Delta\phi\right)\nonumber\\
&amp;\approx\cos\left(\sqrt{k_x}\rho\theta +L\sqrt{k_x}/2\right)
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(\Delta \phi=\arcsin(L\sqrt{k_x}/2)\)</span>.  Here we ignore any terms beyond <span class="math notranslate nohighlight">\(L^2 k(x)\)</span>.  And we know that <span class="math notranslate nohighlight">\(L^2 k(x) \le L^2/\rho^2\)</span></p>
<p>Therefore for one turn, which has <span class="math notranslate nohighlight">\(N\)</span> such segments, the phase advance is :</p>
<div class="amsmath math notranslate nohighlight" id="equation-69b191bf-d2af-43c8-aa8b-f32aa9d6d421">
<span class="eqno">(127)<a class="headerlink" href="#equation-69b191bf-d2af-43c8-aa8b-f32aa9d6d421" title="Permalink to this equation">#</a></span>\[\begin{align}
\phi(L)&amp;=N\left(\sqrt{k_x}\rho \frac{2\pi}{N} +L\sqrt{k_x}/2\right)\nonumber\\
&amp;\approx 2\pi\rho\sqrt{k_x}\left(1+\frac{NL}{4\pi\rho}\right)\nonumber\\
&amp;=\phi(L=0)\left(1+\frac{NL}{4\pi\rho}\right)
\end{align}\]</div>
<p>And the scaling factor for change the <span class="math notranslate nohighlight">\((x,x')\)</span> to <span class="math notranslate nohighlight">\((x,P_x)\)</span> also  changes by an extra factor <span class="math notranslate nohighlight">\(\left(1+\frac{NL}{4\pi\rho}\right)\)</span>.</p>
<p>The weak-focusing scheme has large limitation since the bending gradient has to be continuous.  Later on the theory of strong focusing enables smaller beam size.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./transverse_BD/basic"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../magnet/magnets.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Overview of Accelerator Magnets</p>
      </div>
    </a>
    <a class="right-next"
       href="twiss_param.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Twiss Parametrization</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design-trajectory">Design Trajectory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-look-beam-motion-in-quadrupole-field">First look: Beam motion in Quadrupole field</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curvilinear-coordinate-system">Curvilinear Coordinate System</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hamiltonian-approach">Hamiltonian Approach</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lagrangian-to-hamiltonian">Lagrangian to Hamiltonian</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformation-to-frenet-serret-coordinate-system">Transformation to Frenet-Serret coordinate system</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-s-as-independent-variable">Use <span class="math notranslate nohighlight">\(s\)</span> as independent variable</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplifications-of-hamiltonian">Simplifications of Hamiltonian</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#further-assumptions">Further assumptions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#vector-potentials-for-linear-elements">Vector potentials for linear elements</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transfer-matrix-for-linear-elements">Transfer Matrix for Linear Elements</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drift-space">Drift space</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dipole-main">Dipole (main)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quadrupole-normal">Quadrupole (Normal)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chain-of-linear-elements">Chain of linear elements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-the-betatron-transfer-matrix">Properties of the betatron transfer matrix</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#symplectic-condition">Symplectic condition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#long-term-stability-condition">Long-term stability condition</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#revisit-the-weak-focusing">Revisit, the ‘weak focusing’</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Yue Hao
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>